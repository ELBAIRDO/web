

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IP Transparency &mdash; envoy tag-v1000.1000.1000 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/envoy.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deployment types" href="../deployment_types/deployment_types.html" />
    <link rel="prev" title="Overload manager" href="overload_manager.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                tag-v1000.1000.1000
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../intro.html">Introduction</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../what_is_envoy.html">What is Envoy</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="arch_overview.html">Architecture overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="threading_model.html">Threading model</a></li>
<li class="toctree-l3"><a class="reference internal" href="listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="listener_filters.html">Listener filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="network_filters.html">Network (L3/L4) filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="http_connection_management.html">HTTP connection management</a></li>
<li class="toctree-l3"><a class="reference internal" href="http_filters.html">HTTP filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_sharing_between_filters.html">Static State</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_sharing_between_filters.html#dynamic-state">Dynamic State</a></li>
<li class="toctree-l3"><a class="reference internal" href="http_routing.html">HTTP routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc.html">gRPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="websocket.html">WebSocket and HTTP upgrades</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="service_discovery.html">Service discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="health_checking.html">Health checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="connection_pooling.html">Connection pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="load_balancing/load_balancing.html">Load Balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="outlier.html">Outlier detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="circuit_breaking.html">Circuit breaking</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_rate_limiting.html">Global rate limiting</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl.html">TLS</a></li>
<li class="toctree-l3"><a class="reference internal" href="statistics.html">Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime.html">Runtime configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="tracing.html">Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="tcp_proxy.html">TCP proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="access_logging.html">Access logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="mongo.html">MongoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamo.html">DynamoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="redis.html">Redis</a></li>
<li class="toctree-l3"><a class="reference internal" href="hot_restart.html">Hot restart</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic_configuration.html">Dynamic configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="init.html">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="draining.html">Draining</a></li>
<li class="toctree-l3"><a class="reference internal" href="scripting.html">Scripting</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext_authz_filter.html">External Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="overload_manager.html">Overload manager</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">IP Transparency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-ip-transparency">What is IP Transparency</a></li>
<li class="toctree-l4"><a class="reference internal" href="#http-headers">HTTP Headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proxy-protocol">Proxy Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#original-source-listener-filter">Original Source Listener Filter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../deployment_types/deployment_types.html">Deployment types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../comparison.html">Comparison to similar systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_help.html">Getting help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_history.html">Version history</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../start/start.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-v2/api.html">v2 API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/overview.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">envoy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../intro.html">Introduction</a> &raquo;</li>
        
          <li><a href="arch_overview.html">Architecture overview</a> &raquo;</li>
        
      <li>IP Transparency</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/intro/arch_overview/ip_transparency.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ip-transparency">
<span id="arch-overview-ip-transparency"></span><h1>IP Transparency<a class="headerlink" href="#ip-transparency" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-ip-transparency">
<h2>What is IP Transparency<a class="headerlink" href="#what-is-ip-transparency" title="Permalink to this headline">¶</a></h2>
<p>As a proxy, Envoy is an IP endpoint: it has its own IP address, distinct from that of any downstream
requests. Consequently, when Envoy establishes connections to upstream hosts, the IP address of that
connection will be different from that of any proxied connections.</p>
<p>Sometimes the upstream server or network may need to know the original IP address of the connection,
called the <em>downstream remote address</em>, for many reasons. Some examples include:</p>
<ul class="simple">
<li>the IP address being used to form part of an identity,</li>
<li>the IP address being used to enforce network policy, or</li>
<li>the IP address being included in an audit.</li>
</ul>
<p>Envoy supports multiple methods for providing the downstream remote address to the upstream host.
These techniques vary in complexity and applicability.</p>
</div>
<div class="section" id="http-headers">
<h2>HTTP Headers<a class="headerlink" href="#http-headers" title="Permalink to this headline">¶</a></h2>
<p>HTTP headers may carry the original IP address of the request in the
<a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-forwarded-for"><span class="std std-ref">x-forwarded-for</span></a> header. The upstream server
can use this header to determine the downstream remote address.</p>
<p>The HTTP header approach has a few downsides:</p>
<ul class="simple">
<li>It is only applicable to HTTP.</li>
<li>It may not be supported by the upstream host.</li>
<li>It requires careful configuration.</li>
</ul>
</div>
<div class="section" id="proxy-protocol">
<h2>Proxy Protocol<a class="headerlink" href="#proxy-protocol" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.haproxy.org/download/1.9/doc/proxy-protocol.txt">HAProxy Proxy Protocol</a> defines a
protocol for communicating metadata about a connection over TCP, prior to the main TCP stream. This
metadata includes the source IP. Envoy supports consuming this information using
<a class="reference internal" href="../../configuration/listener_filters/proxy_protocol.html#config-listener-filters-proxy-protocol"><span class="std std-ref">Proxy Protocol filter</span></a>, which may be used to recover
the downstream remote address for propagation into an
<a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-forwarded-for"><span class="std std-ref">x-forwarded-for</span></a> header. It can also be used in
conjunction with the
<a class="reference internal" href="#arch-overview-ip-transparency-original-src-listener"><span class="std std-ref">Original Src Listener Filter</span></a>.</p>
<p>Some drawbacks to Proxy Protocol:</p>
<ul class="simple">
<li>It only supports TCP protocols.</li>
<li>It requires upstream host support.</li>
<li>Envoy cannot yet send it to the upstream.</li>
</ul>
</div>
<div class="section" id="original-source-listener-filter">
<span id="arch-overview-ip-transparency-original-src-listener"></span><h2>Original Source Listener Filter<a class="headerlink" href="#original-source-listener-filter" title="Permalink to this headline">¶</a></h2>
<p>In controlled deployments, it may be possible to replicate the downstream remote address on the
upstream connection by using a
<a class="reference internal" href="../../configuration/listener_filters/original_src_filter.html#config-listener-filters-original-src"><span class="std std-ref">Original Source listener filter</span></a>. No metadata is added
to the upstream request or stream. Rather, the upstream connection itself will be established with
the downstream remote address as its source address. This filter will work with any upstream
protocol or host. However, it requires fairly complex configuration, and it may not be supported in
all deployments due to routing constraints.</p>
<p>Some drawbacks to the Original Source filter:</p>
<ul class="simple">
<li>It requires that Envoy have access to the downstream remote address.</li>
<li>Its configuration is relatively complex.</li>
<li>It may introduce a slight performance hit due to restrictions on connection pooling.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../deployment_types/deployment_types.html" class="btn btn-neutral float-right" title="Deployment types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overload_manager.html" class="btn btn-neutral" title="Overload manager" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Envoy Project Authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>